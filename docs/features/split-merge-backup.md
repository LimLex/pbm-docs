# 管理大型备份文件上传 

!!! admonition "版本添加：[2.11.0](../release-notes/2.11.0.md)"

随着数据库的增长，备份也会增长。最终，集合或索引可能变得如此之大，以至于其备份文件超过云或本地存储的最大对象大小限制。发生这种情况时，Percona Backup for MongoDB (PBM) 无法上传文件，这可能会中断您的备份策略。

下表提供了支持的备份存储的默认最大大小限制：

| 存储 | 默认大小限制|
| :--- | :--- |
| **AWS S3** | 4.9 TB |
| **MinIO 和 S3 兼容存储** | 4.9 TB |
| **GCS** | 4.9 TB |
| **Azure Blob Storage** | 190 TB |
| **阿里云 OSS** | 48.8 TB |
| **文件系统存储** | 4.9 TB |

这些默认值足以满足大多数用例。但是，您可以为使用的存储配置备份文件的新最大大小。为此，为 `maxObjSizeGB` 配置参数定义文件大小（以 GB 为单位）。 

请谨慎定义新限制，仅在您绝对确定操作时才这样做。设置过低的值可能会导致单个备份文件被拆分为太多较小的文件，这可能会影响性能。

这是 AWS S3 存储的配置示例：

```yaml
storage:
  type: s3
  s3:
    region: us-west-2
    bucket: pbm-test-bucket
    prefix: data/pbm/backup
    credentials:
      access-key-id: <your-access-key-id-here>
      secret-access-key: <your-secret-key-here>
  maxObjSizeGB: 5018
```

## 工作原理

当备份文件超过配置的大小限制时，PBM 执行以下操作：

* 将文件拆分为多个片段，每个片段不超过定义的大小限制。PBM 尊重您的压缩设置，因此压缩的备份在拆分后保持压缩
* 通过向文件名添加 `pbmpart{number}` 标记来命名每个片段。这使 PBM 能够识别和管理单个备份的所有片段。
* 将片段上传到存储

在读取数据以进行操作（如恢复）时，PBM 会自动反转此过程：它从存储中检索所有片段，将它们合并回单个文件，然后继续执行命令。这使整个过程对您的应用程序透明。

通过这种设置最大文件大小的能力，您可以为备份策略做好未来准备，并放心地知道您的数据始终安全且可恢复。 
