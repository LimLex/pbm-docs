# Percona Backup for MongoDB 2.6.0 ({{date.2_6_0}})

[Installation](../installation.md){.md-button}


Percona Backup for MongoDB 是一个分布式、低影响的解决方案，用于创建 MongoDB 分片集群和副本集的一致备份，并将这些备份恢复到特定时间点。

## 发布亮点

此版本提供以下功能和改进：

### 多个存储用于备份和恢复

您现在可以为备份定义多个存储，并指示 PBM 将备份保存到哪个存储：主存储或任何其他（外部）存储。此功能可帮助您在使用云存储时节省数据传输成本，并使您能够密切遵循组织备份策略的要求。

要了解更多信息，请阅读[多个存储用于备份](../features/multi-storage.md)。

### 调整时间点恢复 oplog 切片的节点优先级

您现在不仅可以重新定义备份的节点优先级，还可以重新定义时间点恢复 oplog 切片的节点优先级。例如，您可以指示 PBM 从专用节点或地理位置最近的节点保存 oplog 切片，从而减少网络延迟。

请参阅[调整 oplog 切片的节点优先级](../features/point-in-time-recovery.md#adjust-node-priority-for-oplog-slices) 部分以获取指南。

### 对 PBM 命令执行的额外控制

您现在可以通过为以下命令传递 `--wait-time` 标志来配置命令执行的等待时间：

* pbm config --force-resync --wait --wait-time="5m"
* pbm backup --wait --wait-time="5m"
* pbm restore --wait --wait-time="5m"
* pbm oplog-replay --wait --wait-time="5m"
* pbm profile add --sync --wait --wait-time="5m"
* pbm profile remove --wait --wait-time="5m"
* pbm profile sync --wait --wait-time="5m"
* pbm delete-pitr --older-than --wait --wait-time="5m"
* pbm cleanup --older-than --wait --wait-time="5m"

这样您对 PBM 操作有更多控制。此增强功能还改进了错误日志记录。

### 基于快照的物理备份现已正式可用

随着[基于快照的物理备份](../features/snapshots.md) 现已正式可用，您可以在生产环境中使用此功能，并享受从快照快速恢复的所有好处，几乎可以立即访问数据。

### 放弃对 MongoDB 4.4 的支持

Percona Backup for MongoDB 放弃对 MongoDB 4.4 的支持。Percona Backup for MongoDB 中的现有功能仍与 MongoDB 4.4 和 Percona Server for MongoDB 4.4 兼容；但是，不再针对此版本测试进一步的增强和错误修复。

## 打包更改

* Percona Backup for MongoDB 在 Ubuntu 24.04 (Noble Numbat) 上可用。
* Percona Backup for MongoDB 不再支持 Ubuntu 18.04 (Bionic Beaver)、Debian 10 和 Red Hat Enterprise 7 及其衍生版本，因为这些操作系统已达到生命周期结束。

## 加入 Percona Squad

参与每月 SWAG 抽奖，抢先体验新产品功能，并参加仅限邀请的数据库性能专家"问我任何问题"会议。感兴趣？请在 [squad.percona.com/mongodb](https://squad.percona.com/mongodb) 填写表格。

## 变更日志

### 新功能

* [PBM-1228](https://perconadev.atlassian.net/browse/PBM-1228) - 支持多个存储用于备份和恢复。

### 改进

* [PBM-341](https://perconadev.atlassian.net/browse/PBM-341) - 修复了启动备份时文本输出中的 S3 存储 URL。

* [PBM-901](https://perconadev.atlassian.net/browse/PBM-901), [PBM-1323](https://perconadev.atlassian.net/browse/PBM-1323) - 在 pbm status 输出中显示节点优先级

* [PBM-920](https://perconadev.atlassian.net/browse/PBM-920), [PBM-940](https://perconadev.atlassian.net/browse/PBM-940), [PBM-1043](https://perconadev.atlassian.net/browse/PBM-1043) - 考虑节点优先级进行 oplog 切片

* [PBM-1303](https://perconadev.atlassian.net/browse/PBM-1303) - 添加配置命令执行等待时间的能力

* [PBM-1320](https://perconadev.atlassian.net/browse/PBM-1320) - 如果执行恢复的节点不是主节点，改进逻辑恢复进度的日志记录

* [PBM-1329](https://perconadev.atlassian.net/browse/PBM-1329) - 通过在重命名为最终文件名之前写入临时文件，改进将备份保存到文件系统存储。

* [PBM-1376](https://perconadev.atlassian.net/browse/PBM-1376) - 为 S3 提供商添加 SSE-S3 支持

### 已修复的错误

* [PBM-557](https://perconadev.atlassian.net/browse/PBM-557) - 如果初始节点成为主节点，重新启动选举过程并选举新节点进行 PITR oplog 切片

* [PBM-1190](https://perconadev.atlassian.net/browse/PBM-1190) - 从 `pbm-agent` 环境文件中的 MongoDB 连接 URI 字符串中删除多余参数

* [PBM-1208](https://perconadev.atlassian.net/browse/PBM-1208) - 通过在运行备份之前添加活动锁检查，修复了 pbm-agent 重启后备份挂起的问题

* [PBM-1318](https://perconadev.atlassian.net/browse/PBM-1318) - 恢复在日志中打印 `uploadPartSize` 和 `maxUploadParts` 值

* [PBM-1319](https://perconadev.atlassian.net/browse/PBM-1319) - 修复了即使分配了最高优先级也无法从主节点进行备份的问题

* [PBM-1326](https://perconadev.atlassian.net/browse/PBM-1326) - 在备份期间从严重故障恢复时恢复 PITR oplog 切片。（感谢 Daniel Oliver 报告此问题）

* [PBM-1332](https://perconadev.atlassian.net/browse/PBM-1332) - 修复了在执行 `pbm delete-backup` 或 `pbm cleanup` 命令后物理备份未完全从存储中删除的问题。

* [PBM-1341](https://perconadev.atlassian.net/browse/PBM-1341) - 通过重试关闭操作，修复了在节点关闭阶段物理恢复失败的问题。

* [PBM-1343](https://perconadev.atlassian.net/browse/PBM-1343) - 通过在退出函数之前释放锁以允许另一个节点上的 pbm-agent 继续切片，修复了 `pbm-agent` 无法启动 oplog 切片的问题。（感谢 Tomasz Spyrka 报告此问题并做出贡献）

* [PBM-1344](https://perconadev.atlassian.net/browse/PBM-1344) - 如果 PBM 无法赶上存储上的旧 oplog 切片，从新的完整备份继续 PITR oplog 切片。

* [PBM-1350](https://perconadev.atlassian.net/browse/PBM-1350) - 从日志输出中隐藏密码

* [PBM-1360](https://perconadev.atlassian.net/browse/PBM-1360) - 在物理恢复期间删除 `pbm.Lock` 集合以防止恢复过多的锁

* [PBM-1364](https://perconadev.atlassian.net/browse/PBM-1364) - 确保集群领导者重启后 PITR 例程完全运行

* [PBM-1367](https://perconadev.atlassian.net/browse/PBM-1367) - 禁止对具有分片时间序列集合的部署进行备份

* [PBM-1239](https://perconadev.atlassian.net/browse/PBM-1239) - 通过使用支持重试的库，修复了在 GCS 上逻辑备份失败的问题

* [PBM-1348](https://perconadev.atlassian.net/browse/PBM-1348) - 修复了在 pbm 命令中使用 `--wait` 进行 JSON 输出时 shell 的不正确行为

* [PBM-1377](https://perconadev.atlassian.net/browse/PBM-1377) - 修复了当 PITR 的 oplog 范围不足时备份无法启动的问题

* [PBM-1057](https://perconadev.atlassian.net/browse/PBM-1057) - 防止 PBM 在正在执行初始同步的节点上启动备份和 oplog 切片
