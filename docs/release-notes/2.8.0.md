# Percona Backup for MongoDB 2.8.0 ({{date.2_8_0}})

[Installation](../installation.md){.md-button}


Percona Backup for MongoDB 是一个分布式、低影响的解决方案，用于创建 MongoDB 分片集群和副本集的一致备份，并将这些备份恢复到特定时间点。

## 发布亮点

此版本提供以下功能和改进：

## 更好地组织选择性备份

现在您不仅可以为选择性恢复定义多个命名空间，还可以为选择性备份定义多个命名空间。这样，您可以在单个备份下累积所需数据，从而更好地组织备份。在[教程](../usage/backup-selective.md) 中了解如何备份多个命名空间。

## pbm-agents 与备份存储通信中的网络路由控制

您现在可以通过为它们定义自定义端点来控制 pbm-agents 如何到达同一远程备份存储。这样，您可以尊重运行 pbm-agents 的服务器所在数据中心的网络设置，并确保 PBM 的正常运行。AWS 和 Microsoft Azure Blob 存储支持自定义端点。在[文档](../details/s3-storage.md#multiple-endpoints-to-the-same-s3-storage) 中了解更多关于端点定义的信息

## 通过以不同名称恢复同一集合简化故障排除

现在，您可以在特定时间点以不同名称恢复单个集合，同时保留当前集合。恢复的集合具有与您备份的集合相同的数据和索引。这使得比较两个集合中的数据并识别导致数据库问题的原因变得更加容易。因此，您的故障排除工作显著减少。

要了解更多关于此功能的信息，请参阅文档中的[以不同名称恢复集合](../features/selective-backup.md#restore-a-collection-under-a-different-name) 部分

## 通过诊断报告减少故障排除时间

一次性收集排查备份和恢复问题所需的所有信息。生成有关操作执行的综合诊断报告，您可以自己深入研究，或者向我们的专家提交错误报告并附上诊断归档文件。这样您可以减少迭代时间并加速问题解决。

查看[诊断报告](../troubleshoot/pbm-report.md) 了解更多详细信息。

## 使用自定义日志输出路径改进日志轮转

您现在可以将每个 `pbm-agent` 的日志信息输出到自定义路径的文件。这样您可以引入日志轮转，有效管理系统日志，并遵守日志记录和审计的安全法规。 

在[文档](../manage/logpath.md) 中了解更多关于如何配置自定义日志路径的信息

## 备份的额外灵活性

PBM 不再使用 mongodump 进行备份，而是使用自己的 dump 实现。这使得备份操作更加灵活，因为它消除了 mongodump 的限制，并为进一步的改进开辟了空间。 

## 支持的 MongoDB 版本的更改

从本版本开始，PBM 支持 Percona Server for MongoDB 8.0 和 MongoDB Community 8.0。 

同时，PBM 不再支持 Percona Server for MongoDB 5.0 和 MongoDB Community 5.0，因为它们已进入生命周期结束阶段。现有功能仍与版本 5.0 兼容。但是，我们将不再针对此版本测试新功能和改进。

## 已知限制

对于具有配置分片的设置，选择性备份和恢复失败。在 [PBM-1465](https://perconadev.atlassian.net/browse/PBM-1465) 中查找更多详细信息。

## 变更日志

### 新功能

* [PBM-887](https://perconadev.atlassian.net/browse/PBM-887) - 添加生成诊断报告的能力

* [PBM-1211](https://perconadev.atlassian.net/browse/PBM-1211) - 能够为同一 S3 存储设置多个端点

* [PBM-1226](https://perconadev.atlassian.net/browse/PBM-1226) - 添加通过环境变量或命令行为 pbm-agent 定义自定义日志路径的能力

* [PBM-1421](https://perconadev.atlassian.net/browse/PBM-1421) - 添加克隆集合的能力

* [PBM-1422](https://perconadev.atlassian.net/browse/PBM-1422) - 调整 Oplog 和 PITR 以支持克隆的集合

* [PBM-1454](https://perconadev.atlassian.net/browse/PBM-1454) 所有 pbm-agent 选项的配置文件

### 改进

* [PBM-1358](https://perconadev.atlassian.net/browse/PBM-1358) - 改进具有配置分片的部署的选择性恢复行为

* [PBM-1405](https://perconadev.atlassian.net/browse/PBM-1405) - 实现 dump 以替换 `mongodump` 以获得更多灵活性

* [PBM-1414](https://perconadev.atlassian.net/browse/PBM-1414)- 更改默认的 --numInsertionWorkersPerCollection 并添加通过命令行定义它们的能力

* [PBM-1417](https://perconadev.atlassian.net/browse/PBM-1417) - 允许为选择性备份定义多个命名空间


### 已修复的错误

* [PBM-1347](https://perconadev.atlassian.net/browse/PBM-1347) - 如果由于恢复时间不当而导致时间点恢复失败，在 `pbm describe-restore` 输出中报告错误

* [PBM-1366](https://perconadev.atlassian.net/browse/PBM-1366) - 修复了如果在逻辑备份期间删除集合，`pbm-agent` 失败的问题  
* [PBM-1390](https://perconadev.atlassian.net/browse/PBM-1390)- 修复了在备份取消时 mongodump 可能导致代理崩溃的问题

* [PBM-1398](https://perconadev.atlassian.net/browse/PBM-1398) - 通过确保排除命名空间的所有 oplog 操作，防止修改排除命名空间的集合和索引。 

* [PBM-1426](https://perconadev.atlassian.net/browse/PBM-1426) - 通过添加对内部数据库重启完成的额外检查，修复了在具有时间点恢复的物理恢复期间 PBM 的零星失败

* [PBM-1441](https://perconadev.atlassian.net/browse/PBM-1441) - 将许可证文件添加到 Docker 镜像以通过 Red Hat 的认证



